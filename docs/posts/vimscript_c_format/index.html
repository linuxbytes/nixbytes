<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        A Wizard&#39;s Command Line Incantations for Enchanting C Code in Vim ::
        NixBytes — Linux Admin by day and a Coder by night
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="A Wizard&amp;rsquo;s Command Line Incantations for Enchanting C Code in Vim # A Wizard&amp;rsquo;s Command Line Incantations for Enchanting C Code in Vim Greetings, fellow practitioners of the command line arts! Today, we delve into the mystical world of Vim, where keystrokes become spells, and code transforms at our whim. Join me as we explore a spellbinding Vim script, an incantation designed to transmute chaotic C code into a tapestry of elegance and order."
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/vimscript_c_format/" />







<link rel="stylesheet" href="/css/style.css" />

<link rel="stylesheet" href="/style.css" />


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png" />
<link rel="shortcut icon" href="/img/favicon.png" />


<link href="/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="A Wizard&#39;s Command Line Incantations for Enchanting C Code in Vim"/>
<meta name="twitter:description" content="A Wizard&rsquo;s Command Line Incantations for Enchanting C Code in Vim # A Wizard&rsquo;s Command Line Incantations for Enchanting C Code in Vim Greetings, fellow practitioners of the command line arts! Today, we delve into the mystical world of Vim, where keystrokes become spells, and code transforms at our whim. Join me as we explore a spellbinding Vim script, an incantation designed to transmute chaotic C code into a tapestry of elegance and order."/>



<meta property="og:title" content="A Wizard&#39;s Command Line Incantations for Enchanting C Code in Vim" />
<meta property="og:description" content="A Wizard&rsquo;s Command Line Incantations for Enchanting C Code in Vim # A Wizard&rsquo;s Command Line Incantations for Enchanting C Code in Vim Greetings, fellow practitioners of the command line arts! Today, we delve into the mystical world of Vim, where keystrokes become spells, and code transforms at our whim. Join me as we explore a spellbinding Vim script, an incantation designed to transmute chaotic C code into a tapestry of elegance and order." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/vimscript_c_format/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-11-20T00:00:00+00:00" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >NixBytes</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/posts">Blog</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/posts">Blog</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <article class="post">
    <h1 class="post-title">A Wizard&rsquo;s Command Line Incantations for Enchanting C Code in Vim</h1>
    <div class="post-meta">
      
        <time class="post-date">
          2023-11-20
        </time>

        
          
        
      

      


      
    </div>

    

    

    <div class="post-content">
      
      <h1 id="a-wizards-command-line-incantations-for-enchanting-c-code-in-vim">
  A Wizard&rsquo;s Command Line Incantations for Enchanting C Code in Vim
  <a href="#a-wizards-command-line-incantations-for-enchanting-c-code-in-vim" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p>A Wizard&rsquo;s Command Line Incantations for Enchanting C Code in Vim
Greetings, fellow practitioners of the command line arts! Today, we delve into the mystical world of Vim, where keystrokes become spells, and code transforms at our whim. Join me as we explore a spellbinding Vim script, an incantation designed to transmute chaotic C code into a tapestry of elegance and order.
The Enchanted Scroll: Our Vim Spellbook</p>
<p>In the heart of our magical library lies a spell written in the ancient runes of Vim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vim" data-lang="vim"><span style="display:flex;"><span><span style="color:#66d9ef">function</span>! <span style="color:#a6e22e">FormatCCode</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34; Save cursor position</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">l</span>:<span style="color:#a6e22e">save_cursor</span> = <span style="color:#a6e22e">getpos</span>(<span style="color:#e6db74">&#34;.&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34; Remove trailing whitespace</span>
</span></span><span style="display:flex;"><span>    %<span style="color:#a6e22e">s</span><span style="color:#e6db74">/\s\+$/</span>/<span style="color:#a6e22e">e</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34; Replace tabs with spaces</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setlocal</span> <span style="color:#a6e22e">expandtab</span>
</span></span><span style="display:flex;"><span>    %<span style="color:#a6e22e">retab</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34; Set C style indentation</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setlocal</span> <span style="color:#a6e22e">cindent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setlocal</span> <span style="color:#a6e22e">cinoptions</span>=:<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">l1</span>,(<span style="color:#ae81ff">0</span>,<span style="color:#a6e22e">u0</span>,<span style="color:#a6e22e">U0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">normal</span> <span style="color:#a6e22e">gg</span>=<span style="color:#a6e22e">G</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34; Adjusting Curly Braces</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34; Place opening brace on a new line</span>
</span></span><span style="display:flex;"><span>    %<span style="color:#a6e22e">s</span><span style="color:#e6db74">/\s*{\s*$/</span>\<span style="color:#a6e22e">r</span>{/<span style="color:#a6e22e">e</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34; Ensure single line spacing before closing brace</span>
</span></span><span style="display:flex;"><span>    %<span style="color:#a6e22e">s</span><span style="color:#e6db74">/\n\s*\n\s*}/</span>\<span style="color:#a6e22e">r</span>}/<span style="color:#a6e22e">e</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34; Reapply indentation after brace adjustments</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">normal</span> <span style="color:#a6e22e">gg</span>=<span style="color:#a6e22e">G</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34; Restore cursor position</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">call</span> <span style="color:#a6e22e">setpos</span>(<span style="color:#e6db74">&#39;.&#39;</span>, <span style="color:#a6e22e">l</span>:<span style="color:#a6e22e">save_cursor</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">endfunction</span>
</span></span></code></pre></div><h3 id="unraveling-the-mystical-code">
  Unraveling the Mystical Code
  <a href="#unraveling-the-mystical-code" class="h-anchor" aria-hidden="true">#</a>
</h3>
<ol>
<li>
<p>The Locator Charm: let l:save_cursor = getpos(&quot;.&quot;) - As a locator spell allows wizards to remember their place in a vast forest, this charm reflects your cursor&rsquo;s position, ensuring you can return to your exact spot after the formatting ritual.</p>
</li>
<li>
<p>The Trailing Wind: %s/\s+$//e - Imagine a gentle breeze that sweeps away all unnecessary spaces at the end of lines. This incantation ensures each line in your code ends cleanly, maintaining the purity of your script.</p>
</li>
<li>
<p>The Space Conjuror: The twin spells setlocal expandtab and %retab work in unison to transform all tabs into spaces. Like a wizard turning lead into gold, these ensure your indentations are universally understood in all realms.</p>
</li>
<li>
<p>The Alignment Hex: setlocal cindent and setlocal cinoptions=:0,l1,(0,u0,U0 - This powerful hex aligns your code in the ancient style of C, organizing your incantations into a readable and structured grimoire.</p>
</li>
<li>
<p>The Grand Alignment: normal gg=G - Envision this as a grand spell that aligns every line from the beginning to the end of your document, bringing harmony and order to your code.</p>
</li>
<li>
<p>The Return Portal: call setpos(&rsquo;.&rsquo;, l:save_cursor) - After the grand sorcery, this spell returns you to your original position, just like a portal spell brings you back to your starting point after a long journey.</p>
</li>
</ol>
<h3 id="casting-the-grand-spell">
  Casting the Grand Spell
  <a href="#casting-the-grand-spell" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>To bring this magic into your realm, inscribe this script into your .vimrc grimoire. In the mystical world of Vim, summon this enchantment on any C script by uttering the incantation <code>:call FormatCCode().</code>
A Mage&rsquo;s Word of Caution
While powerful, this script may need to fully understand the more complex spells of the C language, such as eldritch macros or the riddles of multiline comments. Test this magic on less important scrolls (backup files) before applying it to your main codices.
The Path to Advanced Sorcery
For wizards seeking even more formidable enchantments, explore the realms of vim-autoformat or summon external spirits like clang-format to aid you. These entities offer a plethora of formatting spells for various coding languages, expanding your magical repertoire.
In the end, remember, fellow command line wizards, this Vim script is a tool in your mystical arsenal to bring order and beauty to your code. May your spells be error-free and your coding journeys full of wonder. 🧙‍♂️✨📜</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/posts/leaving_linux_for_bsd/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Leaving linux for BSD</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/posts/hellesc/">
                  <span class="button__text">HellEsc</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </article>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >NixBytes</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2023 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span><a href="https://github.com/panr/hugo-theme-hello-friend" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
    
  </div>
</footer>





<script type="text/javascript" src="/bundle.min.js"></script>


      
    </div>

    
  </body>
</html>
